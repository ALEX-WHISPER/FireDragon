{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\FireDragon\\Loading/assets\\scripts\\FireDragon\\Loading\\LoadingBarControl.js"],"names":["cc","Class","extends","Component","properties","loginBlock","Node","loadingBlock","loadingBar","ProgressBar","defaultLoadingText","loadingStatus","label_LoadingInfo","Label","loadingSpeed","confirm_Update","isLoadingStatusChecked","default","visible","start","updateCheck","update","dt","updateLoadingInfo","setDefaultText","callFunc","progress","string","delay","delayTime","updateResultCheck","bind","node","runAction","sequence","console","log","active","onConfirmVersionUpdated","onCancleVersionUpdated"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,oBAAYL,GAAGM,IADP;AAERC,sBAAcP,GAAGM,IAFT;;AAIRE,oBAAYR,GAAGS,WAJP;AAKRC,4BAAoB,EALZ;;AAOR;AACA;AACA;AACAC,uBAAe,CAVP;;AAYRC,2BAAmBZ,GAAGa,KAZd;AAaRC,sBAAc,CAbN;;AAeRC,wBAAgBf,GAAGM,IAfX;AAgBRU,gCAAwB;AACpBC,qBAAS,KADW;AAEpBC,qBAAS;AAFW;AAhBhB,KAHP;;AAyBLC,WAAO,iBAAW;AACd,aAAKC,WAAL;AACH,KA3BI;;AA6BLC,YAAQ,gBAASC,EAAT,EAAa;AACjB,YAAI,CAAC,KAAKN,sBAAV,EAAkC;AAC9B;AACH;AACD,aAAKO,iBAAL,CAAuBD,EAAvB;AACH,KAlCI;;AAoCLF,iBAAa,uBAAW;AAAA;;AACpB,YAAII,iBAAiBxB,GAAGyB,QAAH,CACrB,YAAM;AACF,kBAAKjB,UAAL,CAAgBkB,QAAhB,GAA2B,CAA3B;AACA,kBAAKd,iBAAL,CAAuBe,MAAvB,GAAgC,MAAKjB,kBAArC;AACH,SAJoB,CAArB;;AAMA,YAAIkB,QAAQ5B,GAAG6B,SAAH,CAAa,CAAb,CAAZ;AACA,YAAIC,oBAAoB9B,GAAGyB,QAAH,CAAY,KAAKK,iBAAL,CAAuBC,IAAvB,CAA4B,IAA5B,CAAZ,CAAxB;;AAEA,aAAKC,IAAL,CAAUC,SAAV,CAAoBjC,GAAGkC,QAAH,CAAYV,cAAZ,EAA4BI,KAA5B,EAAmCE,iBAAnC,CAApB;AACH,KA/CI;;AAiDLA,uBAAmB,6BAAW;AAC1B,aAAKd,sBAAL,GAA8B,IAA9B;AACAmB,gBAAQC,GAAR,CAAY,yBAAZ;;AAEA,gBAAO,KAAKzB,aAAZ;AACI,iBAAK,CAAL;AACI,qBAAKC,iBAAL,CAAuBe,MAAvB,GAAgC,gBAAhC;AACA;AACJ,iBAAK,CAAL;AACI,qBAAKZ,cAAL,CAAoBsB,MAApB,GAA6B,IAA7B;AACA,qBAAKrB,sBAAL,GAA8B,KAA9B;AACA,qBAAKJ,iBAAL,CAAuBe,MAAvB,GAAgC,aAAhC;AACA;AARR;AAUH,KA/DI;;AAiELJ,uBAAmB,2BAASD,EAAT,EAAa;AAC5B,YAAII,WAAW,KAAKlB,UAAL,CAAgBkB,QAA/B;AACAA,oBAAYJ,KAAK,KAAKR,YAAtB;AACA,aAAKN,UAAL,CAAgBkB,QAAhB,GAA2BA,QAA3B;;AAEA,YAAI,KAAKlB,UAAL,CAAgBkB,QAAhB,IAA4B,CAAhC,EAAmC;AAC/BS,oBAAQC,GAAR,CAAY,eAAZ;AACA,iBAAKpB,sBAAL,GAA8B,KAA9B;;AAEA,iBAAKT,YAAL,CAAkB8B,MAAlB,GAA2B,KAA3B;AACA,iBAAKhC,UAAL,CAAgBgC,MAAhB,GAAyB,IAAzB;AACH;AACJ,KA7EI;;AA+ELC,6BAAyB,mCAAW;AAChC,YAAI,KAAKvB,cAAL,CAAoBsB,MAAxB,EAAgC;AAC5B,iBAAKtB,cAAL,CAAoBsB,MAApB,GAA6B,KAA7B;AACA,iBAAKrB,sBAAL,GAA8B,IAA9B;AACH;AACDmB,gBAAQC,GAAR,CAAY,gBAAZ;AACH,KArFI;;AAuFLG,4BAAwB,kCAAW;AAC/B,YAAI,KAAKxB,cAAL,CAAoBsB,MAAxB,EAAgC;AAC5B,iBAAKtB,cAAL,CAAoBsB,MAApB,GAA6B,KAA7B;AACA,iBAAKrB,sBAAL,GAA8B,KAA9B;AACH;AACDmB,gBAAQC,GAAR,CAAY,gBAAZ;AACH;AA7FI,CAAT","file":"LoadingBarControl.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\FireDragon\\Loading","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        loginBlock: cc.Node,\r\n        loadingBlock: cc.Node,\r\n\r\n        loadingBar: cc.ProgressBar,\r\n        defaultLoadingText: '',\r\n\r\n        //  default: \"检测版本更新...\"\r\n        //  0: 最新版本：\"游戏资源加载中，请稍候...\"\r\n        //  1: 检测到新版本\r\n        loadingStatus: 0,\r\n\r\n        label_LoadingInfo: cc.Label,\r\n        loadingSpeed: 0,\r\n\r\n        confirm_Update: cc.Node,\r\n        isLoadingStatusChecked: {\r\n            default: false,\r\n            visible: false\r\n        }\r\n    },\r\n\r\n    start: function() {\r\n        this.updateCheck();\r\n    },\r\n\r\n    update: function(dt) {\r\n        if (!this.isLoadingStatusChecked) {\r\n            return;\r\n        }\r\n        this.updateLoadingInfo(dt);\r\n    },\r\n\r\n    updateCheck: function() {\r\n        let setDefaultText = cc.callFunc(\r\n        () => {\r\n            this.loadingBar.progress = 0;\r\n            this.label_LoadingInfo.string = this.defaultLoadingText;\r\n        });\r\n        \r\n        let delay = cc.delayTime(1);\r\n        let updateResultCheck = cc.callFunc(this.updateResultCheck.bind(this));\r\n\r\n        this.node.runAction(cc.sequence(setDefaultText, delay, updateResultCheck));\r\n    },\r\n\r\n    updateResultCheck: function() {\r\n        this.isLoadingStatusChecked = true;\r\n        console.log(\"trigger to enter update\");\r\n\r\n        switch(this.loadingStatus) {\r\n            case 0:\r\n                this.label_LoadingInfo.string = '游戏资源加载中，请稍候...';\r\n                break;\r\n            case 1:\r\n                this.confirm_Update.active = true;\r\n                this.isLoadingStatusChecked = false;\r\n                this.label_LoadingInfo.string = '正在更新，请稍候...';\r\n                break;\r\n        }\r\n    },\r\n\r\n    updateLoadingInfo: function(dt) {\r\n        let progress = this.loadingBar.progress;\r\n        progress += dt * this.loadingSpeed;\r\n        this.loadingBar.progress = progress;\r\n\r\n        if (this.loadingBar.progress >= 1) {\r\n            console.log(\"loading, done\");\r\n            this.isLoadingStatusChecked = false;\r\n\r\n            this.loadingBlock.active = false;\r\n            this.loginBlock.active = true;\r\n        }\r\n    },\r\n\r\n    onConfirmVersionUpdated: function() {\r\n        if (this.confirm_Update.active) {\r\n            this.confirm_Update.active = false;\r\n            this.isLoadingStatusChecked = true;\r\n        }\r\n        console.log(\"confirm update\");\r\n    },\r\n\r\n    onCancleVersionUpdated: function() {\r\n        if (this.confirm_Update.active) {\r\n            this.confirm_Update.active = false;\r\n            this.isLoadingStatusChecked = false;\r\n        }\r\n        console.log(\"cancled update\");\r\n    }\r\n});\r\n"]}