{"version":3,"sources":["wxLoginControl.js"],"names":["cc","Class","extends","Component","properties","wxUserInfoControl","require","onLoad","onWxLogin","sys","isBrowser","wxLoginSuccessCallBack","WECHAT_GAME","wxAuthorize","self","wx","authorize","scope","success","console","log","enableGetUserInfo","wxLogin","fail","res","errMsg","login","code","find","active","node","parent"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,2BAAmBC,QAAQ,mBAAR;AADX,KAHP;;AAOLC,YAAQ,kBAAW;AACf;AACA;AACA;AACH,KAXI;;AAaLC,eAAW,qBAAW;AAClB,YAAIR,GAAGS,GAAH,CAAOC,SAAX,EAAsB;AAClB,iBAAKC,sBAAL;AACH,SAFD,MAEO,IAAIX,GAAGS,GAAH,CAAOG,WAAX,EAAwB;AAC3B,iBAAKC,WAAL;AACH;AACJ,KAnBI;;AAqBLA,iBAAa,uBAAW;AACpB,YAAIC,OAAO,IAAX;AACAC,WAAGC,SAAH,CAAa;AACTC,mBAAO,gBADE;AAETC,qBAAS,mBAAW;AAChBC,wBAAQC,GAAR,CAAY,oBAAZ;AACA;AACAN,qBAAKT,iBAAL,CAAuBgB,iBAAvB;AACAP,qBAAKQ,OAAL;AACH,aAPQ;;AASTC,kBAAM,cAASC,GAAT,EAAc;AAChBL,wBAAQC,GAAR,CAAY,wBAAwBI,IAAIC,MAAxC;AACH;AAXQ,SAAb;AAaH,KApCI;;AAsCLH,aAAS,mBAAW;AAChB,YAAIR,OAAO,IAAX;AACAC,WAAGW,KAAH,CAAS;AACLR,qBAAS,iBAASM,GAAT,EAAc;AACnB,oBAAIA,IAAIG,IAAR,EAAc;AACVR,4BAAQC,GAAR,CAAY,mCAAZ;AACAN,yBAAKH,sBAAL;AACH,iBAHD,MAGO;AACLQ,4BAAQC,GAAR,CAAY,mBAAmBI,IAAIC,MAAnC;AACD;AACJ,aARI;;AAULF,kBAAM,gBAAW;AACbJ,wBAAQC,GAAR,CAAY,mBAAmBI,IAAIC,MAAnC;AACH;AAZI,SAAT;AAcH,KAtDI;;AAwDLd,4BAAwB,kCAAW;AAC/BX,WAAG4B,IAAH,CAAQ,sCAAR,EAAgDC,MAAhD,GAAyD,IAAzD;AACA,aAAKC,IAAL,CAAUC,MAAV,CAAiBF,MAAjB,GAA0B,KAA1B;AACH;AA3DI,CAAT","file":"wxLoginControl.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\FireDragon\\wxLogin","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        wxUserInfoControl: require(\"wxUserInfoDisplay\")\r\n    },\r\n\r\n    onLoad: function() {\r\n        // if (this.node.parent.getChildByName('wxLoginPanel') != null) {\r\n        //     this.node.parent.getChildByName('wxLoginPanel').active = false;\r\n        // }\r\n    },\r\n\r\n    onWxLogin: function() {\r\n        if (cc.sys.isBrowser) {\r\n            this.wxLoginSuccessCallBack();\r\n        } else if (cc.sys.WECHAT_GAME) {\r\n            this.wxAuthorize();\r\n        }\r\n    },\r\n\r\n    wxAuthorize: function() {\r\n        var self = this;\r\n        wx.authorize({\r\n            scope: 'scope.userInfo',\r\n            success: function() {\r\n                console.log('authorize: success');\r\n                // self.wxUserInfoControl.getUserInfo();\r\n                self.wxUserInfoControl.enableGetUserInfo();\r\n                self.wxLogin();\r\n            },\r\n    \r\n            fail: function(res) {\r\n                console.log('authorize: failed: ' + res.errMsg);\r\n            }\r\n          });\r\n    },\r\n\r\n    wxLogin: function() {\r\n        var self = this;\r\n        wx.login({\r\n            success: function(res) {\r\n                if (res.code) {\r\n                    console.log(\"login success, server handling...\");\r\n                    self.wxLoginSuccessCallBack();\r\n                } else {\r\n                  console.log(\"login failed: \" + res.errMsg);\r\n                }\r\n            },\r\n      \r\n            fail: function() {\r\n                console.log(\"login failed: \" + res.errMsg);\r\n            }\r\n        });\r\n    },\r\n\r\n    wxLoginSuccessCallBack: function() {\r\n        cc.find('Canvas/EnterRoomBlock/EnterRoomPanel').active = true;\r\n        this.node.parent.active = false;\r\n    }\r\n});\r\n"]}