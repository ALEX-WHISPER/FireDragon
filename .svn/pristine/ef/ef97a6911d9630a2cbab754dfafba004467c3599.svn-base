{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\FireDragon\\EnterRoom/assets\\scripts\\FireDragon\\EnterRoom\\EnterRoom.js"],"names":["cc","Class","extends","Component","properties","_gameControl","default","type","require","visible","_gameModel","_mallModel","label_HowMuchLackOf","Label","label_RecoRechargeValue","label_CostRMB","gamePlayPanel","Node","enterRoomBlock","lackOfTreasurePanel","onLoad","node","parent","getChildByName","active","start","hasInited","howMuchLackOf","recoRechargeValue","costRMB","onChooseRoomToEnter","event","customEventData","curTreasure","allowedTreasure","console","log","js","formatStr","onLackOfTreasure","Math","abs","onEnterRoom","reduction","string","replace","voucherArray","recoRechargeVoucherIndex","voucherValuesArray","i","length","redeem_Treasure","price_rmb","onExitRechargeEntry","onFastRecharge","newTreasure","updateTreasureOnController","updateValuesOnModel","updateValuesOnView","getComponent","setGameInfo","onEnterUserCenter","userCenterBlock","find"],"mappings":"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","file":"EnterRoom.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\FireDragon\\EnterRoom","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: ()=>({\r\n        _gameControl: {\r\n            default: null,\r\n            type: require(\"GameController\"),\r\n            visible: true\r\n        },\r\n\r\n        _gameModel: {\r\n            default: null,\r\n            type: require(\"GameModel\"),\r\n            visible: true\r\n        },\r\n\r\n        _mallModel: {\r\n            default: null,\r\n            type: require(\"MallModel\"),\r\n            visible: true\r\n        },\r\n\r\n        label_HowMuchLackOf: cc.Label,\r\n        label_RecoRechargeValue: cc.Label,\r\n        label_CostRMB:cc.Label,\r\n\r\n        gamePlayPanel: cc.Node,\r\n        enterRoomBlock: cc.Node,\r\n        lackOfTreasurePanel: cc.Node\r\n    }),\r\n\r\n    onLoad: function() {\r\n        if (this.node.parent.getChildByName('EnterRoomPanel') != null) {\r\n            this.node.parent.getChildByName('EnterRoomPanel').active = false;\r\n        }\r\n    },\r\n\r\n    start: function() {\r\n        this.hasInited = false;\r\n\r\n        this.howMuchLackOf = 0;\r\n        this.recoRechargeValue = 0;\r\n        this.costRMB = 0;\r\n    },\r\n    \r\n    onChooseRoomToEnter: function(event, customEventData) {\r\n        let curTreasure = this._gameModel.curTreasure;\r\n        let allowedTreasure = customEventData;\r\n\r\n        if (curTreasure < allowedTreasure) {\r\n            console.log(cc.js.formatStr(\"lack of treasure, curTreasure: %s, allowedTreasure: %s\", curTreasure, allowedTreasure));\r\n            this.onLackOfTreasure(Math.abs(curTreasure - allowedTreasure));\r\n        } else {\r\n            console.log(cc.js.formatStr(\"enough treasure, curTreasure: %s, allowedTreasure: %s\", curTreasure, allowedTreasure));\r\n            this.onEnterRoom();\r\n        }\r\n    },\r\n\r\n    //  not allowed to enter room\r\n    onLackOfTreasure: function(reduction) {\r\n        //  pop out the hint window: You should buy more coin\r\n        this.lackOfTreasurePanel.active = true;\r\n\r\n        //  how much treasure is it lack of\r\n        let howMuchLackOf = reduction;\r\n        this.label_HowMuchLackOf.string = this.label_HowMuchLackOf.string.replace(\r\n            this.hasInited ? this.howMuchLackOf : 'value', howMuchLackOf\r\n        );\r\n        this.howMuchLackOf = howMuchLackOf;\r\n\r\n        //  what is the nearest recommanded recharge value\r\n        let voucherArray = [];\r\n        let recoRechargeVoucherIndex;\r\n        voucherArray = this._mallModel.voucherValuesArray;\r\n\r\n        for(let i = 0; i < voucherArray.length; i++) {\r\n            if (voucherArray[i].redeem_Treasure > this.howMuchLackOf / 10000) {\r\n                console.log(cc.js.formatStr(\"redeem_Treasure: %s, howMuchLackOf: %s\", voucherArray[i].redeem_Treasure, this.howMuchLackOf / 10000));\r\n                recoRechargeVoucherIndex = i;\r\n                break;\r\n            }\r\n        }\r\n        this.label_RecoRechargeValue.string = this.label_RecoRechargeValue.string.replace(\r\n            this.hasInited ? this.recoRechargeValue : 'value', voucherArray[recoRechargeVoucherIndex].redeem_Treasure\r\n        );        \r\n        \r\n        this.recoRechargeValue = voucherArray[recoRechargeVoucherIndex].redeem_Treasure;\r\n\r\n        //  how much money does it cost\r\n        this.label_CostRMB.string = this.label_CostRMB.string.replace(\r\n            this.hasInited ? this.costRMB : 'value', voucherArray[recoRechargeVoucherIndex].price_rmb\r\n        );        \r\n        \r\n        this.costRMB = voucherArray[recoRechargeVoucherIndex].price_rmb;\r\n\r\n        this.hasInited = true;\r\n    },\r\n\r\n    //  allow to enter room\r\n    onEnterRoom: function() {\r\n        this.enterRoomBlock.active = false;\r\n        this.lackOfTreasurePanel.active = false;\r\n\r\n        this.gamePlayPanel.active = true;\r\n    },\r\n\r\n    onExitRechargeEntry: function() {\r\n        this.lackOfTreasurePanel.active = false;\r\n    },\r\n\r\n    onFastRecharge: function() {\r\n        let newTreasure = this._gameModel.curTreasure + this.recoRechargeValue * 10000;\r\n        this._gameControl.updateTreasureOnController(newTreasure);\r\n        this._gameControl.updateValuesOnModel();\r\n        this._gameControl.updateValuesOnView();\r\n        \r\n        //  update game info in this panel\r\n        this.node.getComponent(\"GameInfoDisplay\").setGameInfo();\r\n\r\n        this.onExitRechargeEntry();\r\n    },\r\n\r\n    onEnterUserCenter: function() {\r\n        let userCenterBlock = cc.find('Canvas/UserCenterBlock');\r\n        userCenterBlock.active = true;\r\n        this.node.parent.active = false;\r\n    }\r\n});\r\n"]}