{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\FireDragon\\net/assets\\scripts\\FireDragon\\net\\net.js"],"names":["ByteBuffer","require","ProtoBuf","net","ServerIp","ServerPort","GameId","UserId","ArenaId","CmdId","RoomId","TableId","SceneId","PlayerStatus","EnterRoomType","GameRules","RoomSn","openId","unionid","rspSuccess","loginOk","accessToken","isActive","waitGatewayHeartbeatNum","isLoaded","lastMsgTime","Market","WebId","gameIng","indexPort","ServerType","HALL","PS","MC","GS","CC","CS","SG","IS","DBE","CHAT","GD","CMD_GAME_DATA","MakePack","nCommand","msg","nTargetType","nServerID","msgDv","msgLen","toBuffer","DataView","byteLength","ab","dv","pos","ArrayBuffer","setInt32","setUint8","setInt16","i","getUint8","protoList","LoadProto","name","callback","cc","loader","loadRes","err","data","protoFromString","proto","MakeMsg","msgName","cmd","pack","MsgCmd","protoName","build","decode","SendMsg","nServerType","nServerId","b","console","log","JSON","stringify","ws","readyState","WebSocket","OPEN","send","close","OnRecvMsg","len","getUint16","error","getInt32","slice","onMsgList","OnMsg","printNetDataInfo","stack","mo","view32","Uint32Array","str","length","toString","view8","Uint8Array","j","Connect","conneting","url","onopen","event","onmessage","onerror","onclose","Date","IP_","PORT_","connectStr","setTimeout","binaryType","connectNum","rsp","director","getScene","getChildByName","getComponent","openTips","resetGame","bind","getWSState","CLOSED","UserStatus","Offline","Out","Logout","Delegated","InArena","InRoom","WaitReenter","Sit","Ready","Playing","OnPhone","module","exports"],"mappings":";;;;;;AAAA,IAAIA,aAAaC,QAAQ,YAAR,CAAjB;AACA,IAAIC,WAAWD,QAAQ,UAAR,CAAf;AACA;;AAEA,IAAIE,MAAM,EAAV;AACAA,IAAIC,QAAJ,GAAe,eAAf,EAAiC;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAD,IAAIE,UAAJ,GAAe,CAAC,IAAD,CAAf;AACA;AACAF,IAAIG,MAAJ,GAAY,KAAZ;AACAH,IAAII,MAAJ,GAAa,CAAb;AACAJ,IAAIK,OAAJ,GAAc,GAAd;AACAL,IAAIM,KAAJ,GAAY,CAAZ;AACAN,IAAIO,MAAJ,GAAa,EAAb;AACAP,IAAIQ,OAAJ,GAAc,CAAd;AACAR,IAAIS,OAAJ,GAAc,CAAd;AACAT,IAAIU,YAAJ,GAAmB,CAAnB;AACAV,IAAIW,aAAJ,GAAoB,CAApB;AACAX,IAAIY,SAAJ,GAAgB,EAAhB;AACAZ,IAAIa,MAAJ,GAAa,CAAb;;AAEAb,IAAIc,MAAJ,GAAa,EAAb;AACAd,IAAIe,OAAJ,GAAc,EAAd;AACAf,IAAIgB,UAAJ,GAAiB,IAAjB;AACAhB,IAAIiB,OAAJ,GAAc,KAAd;AACAjB,IAAIkB,WAAJ,GAAkB,EAAlB;;AAEAlB,IAAImB,QAAJ,GAAe,KAAf;AACAnB,IAAIoB,uBAAJ,GAA8B,CAA9B;;AAEApB,IAAIqB,QAAJ,GAAe,KAAf;;AAEArB,IAAIsB,WAAJ,GAAkB,CAAlB;;AAEAtB,IAAIuB,MAAJ,GAAW,CAAX;;AAEAvB,IAAIwB,KAAJ,GAAY,KAAZ;AACAxB,IAAIyB,OAAJ,GAAY,KAAZ;;AAEA;AACAzB,IAAI0B,SAAJ,GAAc,CAAd,EAAkB;;AAElB,IAAIC,aAAa;AACbC,UAAM,CADO,EACL;AACRC,QAAI,CAFS,EAEP;AACNC,QAAI,CAHS,EAGP;AACNC,QAAI,CAJS,EAIP;AACNC,QAAI,CALS,EAKP;AACNC,QAAI,CANS,EAMP;AACNC,QAAI,CAPS,EAOP;AACNC,QAAI,CARS,EAQP;AACNC,SAAK,CATQ,EASN;AACPC,UAAM,EAVO,EAUJ;AACTC,QAAI,EAXS,CAWP;AAXO,CAAjB;AAaAtC,IAAI2B,UAAJ,GAAiBA,UAAjB;;AAEA,IAAMY,gBAAgB,IAAtB;AACAvC,IAAIwC,QAAJ,GAAe,UAAUC,QAAV,EAAoBC,GAApB,EAAyBC,WAAzB,EAAqD;AAAA,QAAfC,SAAe,uEAAH,CAAG;;AAChE,QAAIC,QAAQ,IAAZ;AACA,QAAIC,SAAS,CAAb;AACA,QAAGJ,GAAH,EAAO;AACHA,cAAMA,IAAIK,QAAJ,EAAN;AACAF,gBAAQ,IAAIG,QAAJ,CAAaN,GAAb,CAAR;AACAI,iBAASJ,IAAIO,UAAb;AACH;AACD,QAAIC,KAAK,IAAT;AACA,QAAIC,KAAK,IAAT;AACA,QAAIC,MAAM,CAAV;AACA,QAAIT,eAAehB,WAAWW,EAA9B,EAAkC;AAC9BY,aAAK,IAAIG,WAAJ,CAAgB,IAAI,EAAJ,GAASP,MAAzB,CAAL;AACAK,aAAK,IAAIH,QAAJ,CAAaE,EAAb,CAAL;AACAC,WAAGG,QAAH,CAAYF,GAAZ,EAAiB,KAAKN,MAAtB,EAA8B,IAA9B,EAAqCM,OAAO,CAAP;AACrCD,WAAGI,QAAH,CAAYH,GAAZ,EAAiBzB,WAAWI,EAA5B,EAAgC,IAAhC,EAAuCqB,OAAO,CAAP;AACvCD,WAAGG,QAAH,CAAYF,GAAZ,EAAiBR,SAAjB,EAA4B,IAA5B,EAAmCQ,OAAO,CAAP;AACnCD,WAAGG,QAAH,CAAYF,GAAZ,EAAiB,CAAjB,EAAoB,IAApB,EAA2BA,OAAO,CAAP;AAC3BD,WAAGK,QAAH,CAAYJ,GAAZ,EAAiBb,aAAjB,EAAgC,IAAhC,EAAuCa,OAAO,CAAP;AACvCD,WAAGG,QAAH,CAAYF,GAAZ,EAAiBX,QAAjB,EAA2B,IAA3B,EAAkCW,OAAO,CAAP;AACrC,KATD,MASO;AACHF,aAAK,IAAIG,WAAJ,CAAgB,IAAI,EAAJ,GAASP,MAAzB,CAAL;AACAK,aAAK,IAAIH,QAAJ,CAAaE,EAAb,CAAL;AACAC,WAAGG,QAAH,CAAYF,GAAZ,EAAiB,KAAKN,MAAtB,EAA8B,IAA9B,EAAqCM,OAAO,CAAP;AACrCD,WAAGI,QAAH,CAAYH,GAAZ,EAAiBT,WAAjB,EAA8B,IAA9B,EAAqCS,OAAO,CAAP;AACrCD,WAAGK,QAAH,CAAYJ,GAAZ,EAAiBR,SAAjB,EAA4B,IAA5B,EAAmCQ,OAAO,CAAP;AACnCD,WAAGK,QAAH,CAAYJ,GAAZ,EAAiB,CAAjB,EAAoB,IAApB,EAA2BA,OAAO,CAAP;AAC3BD,WAAGG,QAAH,CAAYF,GAAZ,EAAiB,CAAjB,EAAoB,IAApB,EAA2BA,OAAO,CAAP;AAC3BD,WAAGK,QAAH,CAAYJ,GAAZ,EAAiBX,QAAjB,EAA2B,IAA3B,EAAkCW,OAAO,CAAP;AACrC;AACD,SAAK,IAAIK,IAAI,CAAb,EAAgBA,IAAIX,MAApB,EAA4BW,KAAML,KAAlC,EAAyC;AACrCD,WAAGI,QAAH,CAAYH,GAAZ,EAAiBP,MAAMa,QAAN,CAAeD,CAAf,CAAjB;AACH;AACD,WAAOP,EAAP;AACH,CAlCD;;AAoCA,IAAIS,YAAY,EAAhB;AACA3D,IAAI4D,SAAJ,GAAgB,UAAUC,IAAV,EAAgBC,QAAhB,EAA0B;AACtCC,OAAGC,MAAH,CAAUC,OAAV,CAAkB,WAAWJ,IAA7B,EAAmC,UAAUK,GAAV,EAAeC,IAAf,EAAqB;AACpDR,kBAAUE,IAAV,IAAkB9D,SAASqE,eAAT,CAAyBD,IAAzB,CAAlB;AACA;AACA,YAAGL,QAAH,EAAY;AACRA;AACH;AACJ,KAND;AAOH,CARD;;AAUA,IAAIO,QAAQ,EAAZ;AACArE,IAAIsE,OAAJ,GAAc,UAASC,OAAT,EAAkBC,GAAlB,EAAuBC,IAAvB,EAA6B;AACvC,QAAG,CAACF,OAAD,IAAYC,GAAf,EAAmB;AACfD,kBAAUvE,IAAI0E,MAAJ,CAAWF,GAAX,CAAV;AACH;AACD,QAAG,CAACA,GAAJ,EAAQ;AACJA,cAAMxE,IAAI0E,MAAJ,CAAWH,OAAX,CAAN;AACH;AACDvE,QAAIM,KAAJ,GAAYkE,GAAZ;AACA,QAAI9B,MAAM2B,MAAME,OAAN,CAAV;AACA,QAAI,CAAC7B,GAAL,EAAU;AACN,aAAK,IAAIiC,SAAT,IAAsBhB,SAAtB,EAAiC;AAC7BjB,kBAAMiB,UAAUgB,SAAV,EAAqBC,KAArB,CAA2B,QAAML,OAAjC,CAAN;AACA,gBAAI7B,GAAJ,EAAS;AACL2B,sBAAME,OAAN,IAAiB7B,GAAjB;AACA;AACH;AACJ;AACJ;AACD,QAAGA,OAAO+B,IAAV,EAAe;AACX,eAAO/B,IAAImC,MAAJ,CAAWJ,IAAX,CAAP;AACH;AACD,WAAO/B,MAAM,IAAIA,GAAJ,EAAN,GAAkB,IAAzB;AACH,CAtBD;;AAyBA;AACA;AACA1C,IAAI8E,OAAJ,GAAc,UAASpC,GAAT,EAAcqC,WAAd,EAA2BC,SAA3B,EAA+C;AAAA,QAATC,CAAS,uEAAL,IAAK;;AACzD,QAAIR,OAAOzE,IAAIwC,QAAJ,CAAaxC,IAAIM,KAAjB,EAAwBoC,GAAxB,EAA6BqC,WAA7B,EAA0CC,SAA1C,CAAX;AACAE,YAAQC,GAAR,CAAY,kBAAgBnF,IAAI0E,MAAJ,CAAW1E,IAAIM,KAAf,CAAhB,GAAwC,WAAxC,GAAsDN,IAAIM,KAA1D,GAAkE,OAAlE,GAA0E8E,KAAKC,SAAL,CAAe3C,GAAf,CAAtF;AACA,QAAG4C,MAAM,IAAN,IAAcA,GAAGC,UAAH,KAAkBC,UAAUC,IAA7C,EACA;AACIH,WAAGI,IAAH,CAAQjB,IAAR;AACH,KAHD,MAKA;AACIzE,YAAI2F,KAAJ;AACA;AACA;AACA;AACH;AACJ,CAdD;;AAgBA;;;;;;;;;;;;;;;AAeA3F,IAAI4F,SAAJ,GAAgB,UAASnB,IAAT,EAAc;AAC1B,QAAItB,KAAK,IAAIH,QAAJ,CAAayB,IAAb,CAAT;AACA,QAAIrB,MAAM,EAAV;AACA,QAAIyC,MAAMpB,KAAKxB,UAAf;AACA,QAAIuB,MAAM,CAAC,CAAX;AACA,QAAGqB,OAAO,EAAV,EACA;AACIrB,cAAMrB,GAAG2C,SAAH,CAAa,CAAb,EAAgB,IAAhB,CAAN;AACH,KAHD,MAII;AACAZ,gBAAQa,KAAR,CAAc,2BAA2BvB,GAA3B,GAAiC,SAAjC,GAA6CqB,GAA3D;AACA,eAAO,IAAP;AACH;AACD,QAAGrB,OAAOjC,aAAV,EAAwB;AACpB,YAAGsD,OAAO,EAAV,EACA;AACIrB,kBAAMrB,GAAG6C,QAAH,CAAY,EAAZ,EAAgB,IAAhB,CAAN;AACA5C,kBAAM,EAAN;AACH,SAJD,MAMA;AACI8B,oBAAQa,KAAR,CAAc,2BAA2BvB,GAA3B,GAAiC,SAAjC,GAA6CqB,GAA3D;AACA,mBAAO,IAAP;AACH;AACJ;AACDpB,WAAOA,KAAKwB,KAAL,CAAW7C,GAAX,CAAP;;AAEA,QAAIV,MAAM1C,IAAIsE,OAAJ,CAAY,IAAZ,EAAkBE,GAAlB,EAAuBC,IAAvB,CAAV;AACA,WAAO,EAACD,KAAMA,GAAP,EAAY9B,KAAMA,GAAlB,EAAP;AACH,CA7BD;;AA+BA,IAAIwD,YAAY,EAAhB;AACAlG,IAAImG,KAAJ,GAAY,UAAS3B,GAAT,EAAcV,QAAd,EAAuB;AAC/BoC,cAAU1B,GAAV,IAAiBV,QAAjB;AACH,CAFD;;AAKA;AACA9D,IAAIoG,gBAAJ,GAAuB,UAAS3B,IAAT,EAAeP,GAAf,EAAmB;;AAEtC,QAAIf,KAAK,IAAIH,QAAJ,CAAayB,IAAb,CAAT;AACA,QAAIoB,MAAMpB,KAAKxB,UAAf;AACAiC,YAAQa,KAAR,CAAc,yCAAd;AACA,QAAG7B,GAAH,EACA;AACIgB,gBAAQa,KAAR,CAAc7B,IAAImC,KAAlB;AACH;;AAED,QAAIC,KAAKT,MAAM,CAAf;AACA,QAAGS,MAAM,CAAT,EACA;AACI,YAAIC,SAAS,IAAIC,WAAJ,CAAgB/B,IAAhB,CAAb;AACA,YAAIgC,MAAM,MAAV;AACA,aAAI,IAAIhD,IAAE,CAAV,EAAaA,IAAI8C,OAAOG,MAAxB,EAAgCjD,GAAhC,EACA;AACIgD,mBAAOF,OAAO9C,CAAP,EAAUkD,QAAV,CAAmB,CAAnB,IAAwB,GAA/B;AACH;AACDzB,gBAAQC,GAAR,CAAYoB,OAAOG,MAAP,GAAgB,0BAAhB,GAA8CD,GAA1D;AACH,KATD,MAWA;AACI,YAAIA,MAAM,KAAV;AACA,YAAIG,QAAQ,IAAIC,UAAJ,CAAepC,IAAf,CAAZ;AACA,aAAI,IAAIqC,IAAE,CAAV,EAAaA,IAAIR,EAAjB,EAAqBQ,GAArB,EACA;AACIL,mBAAOG,MAAME,CAAN,EAASH,QAAT,CAAkB,CAAlB,IAAuB,GAA9B;AACH;;AAED,YAAGC,MAAMF,MAAN,GAAe,CAAlB,EACA;AACID,mBAAO,aAAP;AACA,gBAAItC,OAAOM,KAAKwB,KAAL,CAAWK,EAAX,CAAX;AACA,gBAAIC,SAAS,IAAIC,WAAJ,CAAgBrC,IAAhB,CAAb;AACA,iBAAI,IAAIV,IAAE,CAAV,EAAaA,IAAI8C,OAAOG,MAAxB,EAAgCjD,GAAhC,EACA;AACIgD,uBAAOF,OAAO9C,CAAP,EAAUkD,QAAV,CAAmB,CAAnB,IAAwB,GAA/B;AACH;AACJ;AACDzB,gBAAQC,GAAR,CAAYoB,OAAOG,MAAP,GAAgB,0BAAhB,GAA8CD,GAA1D;AACH;AACJ,CA1CD;;AA4CA,IAAInB,KAAK,IAAT;AACAtF,IAAI+G,OAAJ,GAAc,YAAW;AACrB,QAAG/G,IAAIgH,SAAP,EACI;;AAEJ,QAAG1B,EAAH,EAAM;AACFJ,gBAAQC,GAAR,CAAY,uCAAuCG,GAAGC,UAA1C,GAAuD,IAAvD,GAA8DD,GAAG2B,GAA7E;AACA3B,WAAG4B,MAAH,GAAY,UAAUC,KAAV,EAAiB;AACzBjC,oBAAQC,GAAR,CAAY,4BAA4BG,GAAGC,UAA/B,GAA4C,IAA5C,GAAmDD,GAAG2B,GAAlE;AACH,SAFD;AAGA3B,WAAG8B,SAAH,GAAe,UAAUD,KAAV,EAAiB;AAC5BjC,oBAAQC,GAAR,CAAY,+BAA+BG,GAAGC,UAAlC,GAA+C,IAA/C,GAAsDD,GAAG2B,GAArE;AACH,SAFD;AAGA3B,WAAG+B,OAAH,GAAa,UAAUF,KAAV,EAAiB;AAC1BjC,oBAAQC,GAAR,CAAY,6BAA6BG,GAAGC,UAAhC,GAA6C,IAA7C,GAAoDD,GAAG2B,GAAnE;AACH,SAFD;AAGA3B,WAAGgC,OAAH,GAAa,UAAUH,KAAV,EAAiB;AAC1BjC,oBAAQC,GAAR,CAAY,6BAA6BG,GAAGC,UAAhC,GAA6C,IAA7C,GAAoDD,GAAG2B,GAAnE;AACH,SAFD;AAGA3B,WAAGK,KAAH;AACAL,aAAK,IAAL;AACA;AACH;;AAEDtF,QAAIsB,WAAJ,GAAkB,IAAIiG,IAAJ,EAAlB;;AAEAvH,QAAIgH,SAAJ,GAAgB,IAAhB;AACA;AACA;AACA;AACA;AACA,QAAIQ,MAAMxH,IAAIC,QAAd;AACA,QAAIwH,QAAQzH,IAAIE,UAAJ,CAAeF,IAAI0B,SAAnB,CAAZ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACI;AACJ;AACA,QAAIgG,aAAa,UAAQF,GAAR,GAAY,GAAZ,GAAgBC,KAAjC;AACAvC,YAAQC,GAAR,CAAY,4BAA4BuC,UAAxC;AACAC,eAAW,YAAW;AAClBrC,aAAK,IAAIE,SAAJ,CAAckC,UAAd,CAAL;AACApC,WAAGsC,UAAH,GAAgB,aAAhB;AACAtC,WAAG4B,MAAH,GAAY,UAAUC,KAAV,EAAiB;AACzB,iBAAKU,UAAL,GAAgB,CAAhB;AACA3C,oBAAQC,GAAR,CAAY,oCAAoCnF,IAAIiB,OAApD;AACA;AACA;AACA;AACAjB,gBAAIgH,SAAJ,GAAgB,KAAhB;AACAhH,gBAAImB,QAAJ,GAAe,IAAf;AACA;AACA,gBAAGnB,IAAIiB,OAAP,EACA,CAMC;AALG;AACA;AACA;AACA;AACA;;AAEJ;AACA;AACA;AACA;AACH,SArBD;;AAuBAqE,WAAG8B,SAAH,GAAe,UAAUD,KAAV,EAAiB;;AAE5BnH,gBAAIsB,WAAJ,GAAkB,IAAIiG,IAAJ,EAAlB,CAF4B,CAEC;AAC7BvH,gBAAIoB,uBAAJ,GAA8B,CAA9B,CAH4B,CAGI;;AAEhCuG,uBAAW,YAAW;AAClB;AACA,oBAAIG,GAAJ;AACA,oBAAIjC,MAAMsB,MAAMhD,IAAN,CAAWlB,UAArB;AACA,oBACA;AACIiC,4BAAQC,GAAR,CAAY,mBAAmBgC,MAAMhD,IAAN,CAAWlB,UAA1C;AACA6E,0BAAM9H,IAAI4F,SAAJ,CAAcuB,MAAMhD,IAApB,CAAN;AACA,wBAAG2D,OAAO,IAAV,EACA;AACI;AACA9H,4BAAIoG,gBAAJ,CAAqBe,MAAMhD,IAA3B,EAAiC,IAAjC;AACA;AACH;AACJ,iBAVD,CAWA,OAAMD,GAAN,EACA;AACIgB,4BAAQC,GAAR,CAAY,WAAZ;AACA;AACAnF,wBAAIoG,gBAAJ,CAAqBe,MAAMhD,IAA3B,EAAiCD,GAAjC;AACA;AACH;AACD,oBAAI;AACAgB,4BAAQC,GAAR,CAAY,kBAAgBnF,IAAI0E,MAAJ,CAAWoD,IAAItD,GAAf,CAAhB,GAAsC,OAAtC,GAA8CY,KAAKC,SAAL,CAAeyC,GAAf,CAA1D;AACA,wBAAIhE,WAAWoC,UAAU4B,IAAItD,GAAd,CAAf;AACA,wBAAG,CAACV,QAAJ,EAAa;AACTA,mCAAW9D,IAAI,OAAKA,IAAI0E,MAAJ,CAAWoD,IAAItD,GAAf,CAAT,CAAX;AACH;AACD,wBAAGV,QAAH,EAAY;AACRA,iCAASgE,IAAIpF,GAAb;AACH;AACJ,iBATD,CAUA,OAAOqD,KAAP,EAAc;AACVb,4BAAQa,KAAR,CAAc,mDAAmD+B,IAAItD,GAAvD,GAA6D,IAA7D,GAAoEuB,MAAMM,KAAxF;AACAnB,4BAAQa,KAAR,CAAc,kBAAkB/F,IAAI0E,MAAJ,CAAWoD,IAAItD,GAAf,CAAlB,GAAwC,OAAxC,GAAkDY,KAAKC,SAAL,CAAeyC,GAAf,CAAhE;AACH;AACJ,aApCD,EAoCE,GApCF;AAqCH,SA1CD;;AA4CAxC,WAAG+B,OAAH,GAAa,UAAUF,KAAV,EAAiB;AAC1BjC,oBAAQC,GAAR,CAAY,oBAAZ;AACAnF,gBAAIgH,SAAJ,GAAgB,KAAhB;AACA1B,eAAGK,KAAH;AACAT,oBAAQC,GAAR,CAAY,eAAZ;AACH,SALD;;AAOAG,WAAGgC,OAAH,GAAa,UAAUH,KAAV,EAAiB;AAC1BjC,oBAAQC,GAAR,CAAY,oBAAZ;AACAnF,gBAAIgH,SAAJ,GAAgB,KAAhB;AACA1B,iBAAK,IAAL;AACAtF,gBAAImB,QAAJ,GAAe,KAAf;AACA,gBAAGnB,IAAIiB,OAAP,EAAe;AACXjB,oBAAIiB,OAAJ,GAAY,KAAZ;AACA8C,mBAAGgE,QAAH,CAAYC,QAAZ,GAAuBC,cAAvB,CAAsC,QAAtC,EAAgDA,cAAhD,CAA+D,aAA/D,EAA8EC,YAA9E,CAA2F,aAA3F,EAA0GC,QAA1G,CAAmH,MAAnH;AACApE,mBAAGgE,QAAH,CAAYC,QAAZ,GAAuBC,cAAvB,CAAsC,QAAtC,EAAgDA,cAAhD,CAA+D,WAA/D,EAA4EC,YAA5E,CAAyF,QAAzF,EAAmGE,SAAnG,CAA6G,CAA7G;AACH,aAJD,MAIK;AACD,oBAAGpI,IAAI0B,SAAJ,GAAc1B,IAAIE,UAAJ,CAAewG,MAAhC,EAAuC;AACpC1G,wBAAI+G,OAAJ;AACA/G,wBAAI0B,SAAJ;AACF,iBAHD,MAGK;AACF1B,wBAAI0B,SAAJ,GAAc,CAAd;AACF;AACJ;AACN,SAjBC;AAkBH,KA/FU,CA+FT2G,IA/FS,CA+FJ,IA/FI,CAAX,EA+Fa,CA/Fb;AAgGH,CApJD;;AAsJArI,IAAIsI,UAAJ,GAAiB,YACjB;AACI,QAAGhD,MAAM,IAAT,EACI,OAAOE,UAAU+C,MAAjB;AACJ,WAAOjD,GAAGC,UAAV;AACH,CALD;;AAOAvF,IAAI2F,KAAJ,GAAY,YACZ;AACIT,YAAQC,GAAR,CAAY,kBAAZ;AACA,QAAIG,EAAJ,EACIA,GAAGK,KAAH;AACP,CALD;;AAOA,IAAM6C,aACN;AACCC,aAAQ,CADT;AAECC,SAAI,CAFL;AAGCC,YAAO,CAHR;AAICC,eAAU,CAJX;AAKCC,aAAQ,CALT;AAMCC,YAAO,CANR;AAOCC,iBAAY,CAPb;AAQCC,SAAI,CARL;AASCC,WAAM,CATP;AAUCC,aAAQ,CAVT;AAWCC,aAAQ;AAXT,CADA;;AAeAnJ,IAAIwI,UAAJ,GAAiBA,UAAjB;;AAEAY,OAAOC,OAAP,GAAiBrJ,GAAjB","file":"net.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\FireDragon\\net","sourcesContent":["var ByteBuffer = require(\"bytebuffer\");\r\nvar ProtoBuf = require(\"protobuf\");  \r\n// const EventManager=require('EventManager');  //  EASON COMMENT\r\n\r\nvar net = {} \r\nnet.ServerIp = \"172.12.10.126\";  //  FireDragon\r\n// net.ServerIp = \"testqpddd.qianz.com\"     // 测试IP \r\n// net.ServerIp = \"172.12.10.75\"     // qf测试IP \r\n// net.ServerIp=\"112.74.79.163\"      //aliyun 33939\r\n// net.ServerIp=\"119.23.48.231\"         //预发布\r\n// net.ServerIp=\"172.12.10.138\"      \r\n// net.ServerIp=\"120.76.193.250\"      //审核服\r\n// net.ServerIp=\"qpddd.cy9527.com\"      //正式发布\r\n// net.ServerIp=\"172.12.10.69\"      //localhost\r\n// net.ServerIp=\"172.12.10.53\"      //hhl\r\n// net.ServerIp=\"120.25.124.150\"         //h5审核 \r\nnet.ServerPort=[8081];  \r\n// net.ServerPort = [19999,20000,20001,20002];//\"19996\"//\"19996\"//19999\"\r\nnet.GameId =10004\r\nnet.UserId = 0\r\nnet.ArenaId = 106\r\nnet.CmdId = 0\r\nnet.RoomId = 68\r\nnet.TableId = 0\r\nnet.SceneId = 0\r\nnet.PlayerStatus = 0\r\nnet.EnterRoomType = 0\r\nnet.GameRules = \"\"\r\nnet.RoomSn = 0\r\n\r\nnet.openId = \"\"\r\nnet.unionid = \"\"\r\nnet.rspSuccess = true\r\nnet.loginOk = false\r\nnet.accessToken = \"\"\r\n\r\nnet.isActive = false\r\nnet.waitGatewayHeartbeatNum = 0\r\n\r\nnet.isLoaded = false;\r\n\r\nnet.lastMsgTime = 0;\r\n\r\nnet.Market=1;\r\n\r\nnet.WebId = 40033; \r\nnet.gameIng=false;\r\n\r\n// net.indexPort=Math.ceil(Math.random()*4)-1; \r\nnet.indexPort=0;  //记录当前端口\r\n \r\nvar ServerType = {\r\n    HALL: 1,//\t\t--客户端大厅\r\n    PS: 2,//\t\t\t--广场\r\n    MC: 3,//\t\t\t--比赛调度程序，工程名MatchCtrl\r\n    GS: 4,//\t\t\t--比赛桌子服务器，工程名已改为TableServer，命名为GS为了符合大家的习惯称呼\r\n    CC: 5,//\t\t\t--比赛管理中心，工程名预定为ControlCenter\r\n    CS: 6,//\t\t\t--远程控制服务，工程名预定为CtrlService，不一定会用到SG，先定义好占个名额\r\n    SG: 7,//\t\t\t--ServerGate\r\n    IS: 8,//\t\t\t--信息服务中心，工程名InformationService，包括公告、好友、聊天、短信报警、web通信等模块\r\n    DBE: 9,//\t\t\t--DBEngineCenter，不一定会用到，但系统中有此服务程序，定义一个占位置\r\n    CHAT: 10,//         --预留聊天服务器，现在还没有聊天服务器。ServerGate直接转给聊天MC，MC再转给ServerGate实现世界聊天\r\n    GD: 39//\t\t\t--game message\r\n}\r\nnet.ServerType = ServerType\r\n\r\nconst CMD_GAME_DATA = 1039 \r\nnet.MakePack = function (nCommand, msg, nTargetType, nServerID = 0) {\r\n    var msgDv = null\r\n    var msgLen = 0 \r\n    if(msg){\r\n        msg = msg.toBuffer()\r\n        msgDv = new DataView(msg)\r\n        msgLen = msg.byteLength\r\n    }\r\n    var ab = null\r\n    var dv = null\r\n    var pos = 0\r\n    if (nTargetType == ServerType.GD) {\r\n        ab = new ArrayBuffer(4 + 15 + msgLen)\r\n        dv = new DataView(ab)\r\n        dv.setInt32(pos, 15 + msgLen, true); pos += 4\r\n        dv.setUint8(pos, ServerType.GS, true); pos += 1\r\n        dv.setInt32(pos, nServerID, true); pos += 4\r\n        dv.setInt32(pos, 0, true); pos += 4\r\n        dv.setInt16(pos, CMD_GAME_DATA, true); pos += 2\r\n        dv.setInt32(pos, nCommand, true); pos += 4\r\n    } else {\r\n        ab = new ArrayBuffer(4 + 11 + msgLen)\r\n        dv = new DataView(ab);\r\n        dv.setInt32(pos, 11 + msgLen, true); pos += 4\r\n        dv.setUint8(pos, nTargetType, true); pos += 1\r\n        dv.setInt16(pos, nServerID, true); pos += 2\r\n        dv.setInt16(pos, 0, true); pos += 2\r\n        dv.setInt32(pos, 0, true); pos += 4\r\n        dv.setInt16(pos, nCommand, true); pos += 2\r\n    }\r\n    for (var i = 0; i < msgLen; i++ , pos++) {\r\n        dv.setUint8(pos, msgDv.getUint8(i))\r\n    }\r\n    return ab\r\n}\r\n\r\nvar protoList = {}\r\nnet.LoadProto = function (name, callback) {\r\n    cc.loader.loadRes(\"proto/\" + name, function (err, data) {\r\n        protoList[name] = ProtoBuf.protoFromString(data)\r\n        // EventManager.Dispatch('netSuccess');     //  EASON COMMENT\r\n        if(callback){ \r\n            callback()\r\n        }\r\n    })\r\n}\r\n\r\nvar proto = {}\r\nnet.MakeMsg = function(msgName, cmd, pack) {\r\n    if(!msgName && cmd){\r\n        msgName = net.MsgCmd[cmd]\r\n    }\r\n    if(!cmd){\r\n        cmd = net.MsgCmd[msgName]\r\n    }\r\n    net.CmdId = cmd\r\n    var msg = proto[msgName]\r\n    if (!msg) {\r\n        for (var protoName in protoList) {\r\n            msg = protoList[protoName].build(\"SY.\"+msgName)\r\n            if (msg) {\r\n                proto[msgName] = msg\r\n                break\r\n            }\r\n        }\r\n    }\r\n    if(msg && pack){\r\n        return msg.decode(pack)\r\n    }\r\n    return msg ? new msg() : null\r\n}\r\n\r\n\r\n//网络出现故障时的缓存消息，重连后会依次发送出来\r\n// var CacheSendMsgs = new Array()\r\nnet.SendMsg = function(msg, nServerType, nServerId, b = true){\r\n    var pack = net.MakePack(net.CmdId, msg, nServerType, nServerId)\r\n    console.log(\"--->Send cmd:\"+net.MsgCmd[net.CmdId] + \", CmdId: \" + net.CmdId + \"，Msg：\"+JSON.stringify(msg))\r\n    if(ws != null && ws.readyState === WebSocket.OPEN)\r\n    { \r\n        ws.send(pack);\r\n    }\r\n    else\r\n    {\r\n        net.close();\r\n        // cc.director.getScene().getChildByName('Canvas').getChildByName('WindowLayer').getComponent('WindowLayer').openTips('1003');\r\n        // CacheSendMsgs.push(pack);\r\n        // net.Connect();\r\n    }\r\n}\r\n\r\n/* //循环从将缓存消息队列中的消息按顺序发送到服务器\r\n    net.sendCacheMsg = function()\r\n    {\r\n        console.log(\"cache msg send start. msg num = \" + CacheSendMsgs.length + \", ws=\" + ws);\r\n        if(ws != null && ws.readyState === WebSocket.OPEN)\r\n        {\r\n            for(var pack = CacheSendMsgs.shift(); pack != undefined;)\r\n            {\r\n                ws.send(pack);\r\n            }\r\n            console.log(\"cache msg send finish.\");\r\n        }\r\n    }\r\n*/\r\n\r\nnet.OnRecvMsg = function(pack){ \r\n    var dv = new DataView(pack);\r\n    var pos = 11;\r\n    var len = pack.byteLength;\r\n    var cmd = -1;\r\n    if(len >= 11)\r\n    {\r\n        cmd = dv.getUint16(9, true)\r\n    }\r\n    else{\r\n        console.error(\"------OnRecvMsg, cmd: \" + cmd + \", len: \" + len);\r\n        return null;\r\n    }\r\n    if(cmd == CMD_GAME_DATA){\r\n        if(len >= 15)\r\n        {\r\n            cmd = dv.getInt32(11, true)\r\n            pos = 15\r\n        }\r\n        else\r\n        {\r\n            console.error(\"------OnRecvMsg, cmd: \" + cmd + \", len: \" + len);\r\n            return null;\r\n        }\r\n    }\r\n    pack = pack.slice(pos);\r\n\r\n    var msg = net.MakeMsg(null, cmd, pack);\r\n    return {cmd : cmd, msg : msg}\r\n}\r\n\r\nvar onMsgList = {}\r\nnet.OnMsg = function(cmd, callback){\r\n    onMsgList[cmd] = callback\r\n}\r\n\r\n\r\n//输出网络数据包的内容\r\nnet.printNetDataInfo = function(pack, err){\r\n\r\n    var dv = new DataView(pack)\r\n    var len = pack.byteLength;\r\n    console.error(\"------ onmessage parse error ----------\")\r\n    if(err)\r\n    {\r\n        console.error(err.stack)\r\n    }\r\n\r\n    var mo = len % 4;\r\n    if(mo == 0)\r\n    {\r\n        var view32 = new Uint32Array(pack);\r\n        var str = \"32位：\";\r\n        for(var i=0; i < view32.length; i++)\r\n        {\r\n            str += view32[i].toString(2) + \",\"\r\n        }\r\n        console.log(view32.length + \"----------------------, \"  + str)\r\n    }\r\n    else\r\n    {\r\n        var str = \"8位：\";\r\n        var view8 = new Uint8Array(pack);\r\n        for(var j=0; j < mo; j++)\r\n        {\r\n            str += view8[j].toString(2) + \",\"\r\n        }\r\n\r\n        if(view8.length > 4)\r\n        {\r\n            str += \"---|32位：---\"\r\n            var data = pack.slice(mo);\r\n            var view32 = new Uint32Array(data);\r\n            for(var i=0; i < view32.length; i++)\r\n            {\r\n                str += view32[i].toString(2) + \",\"\r\n            }\r\n        }\r\n        console.log(view32.length + \"----------------------, \"  + str)\r\n    }\r\n}\r\n\r\nvar ws = null\r\nnet.Connect = function() { \r\n    if(net.conneting)\r\n        return ;\r\n\r\n    if(ws){\r\n        console.log(\"------ws Connect find ws != null. \" + ws.readyState + \", \" + ws.url)\r\n        ws.onopen = function (event) {\r\n            console.log(\"---close ws onopen---. \" + ws.readyState + \", \" + ws.url)\r\n        }\r\n        ws.onmessage = function (event) {\r\n            console.log(\"---close ws onmessage---. \" + ws.readyState + \", \" + ws.url)\r\n        }\r\n        ws.onerror = function (event) {\r\n            console.log(\"---close ws onerror---. \" + ws.readyState + \", \" + ws.url)\r\n        }\r\n        ws.onclose = function (event) {\r\n            console.log(\"---close ws onclose---. \" + ws.readyState + \", \" + ws.url)\r\n        }\r\n        ws.close();\r\n        ws = null;\r\n        return ;\r\n    }\r\n\r\n    net.lastMsgTime = new Date();\r\n\r\n    net.conneting = true;\r\n    //sendList.length = 0\r\n    // var globalFunc1 = cc.director.getScene().getChildByName('GlobalNode').getComponent('Functions')\r\n    // var ip = globalFunc1.getIp()\r\n    // var port = globalFunc1.getPort()\r\n    var IP_ = net.ServerIp\r\n    var PORT_ = net.ServerPort[net.indexPort]\r\n    // cc.log(ip)\r\n    // cc.log(port)\r\n    // if(ip==null)\r\n    // {\r\n\r\n    // }\r\n    // else\r\n    // {\r\n        // IP_ = ip\r\n    // }\r\n    // if(port==null)\r\n    // {\r\n\r\n    // }\r\n    // else\r\n    // {\r\n        // PORT_ = port\r\n    // }\r\n    var connectStr = \"ws://\"+IP_+\":\"+PORT_;\r\n    console.log(\"------ws Connect str = \" + connectStr);\r\n    setTimeout(function() {\r\n        ws = new WebSocket(connectStr)\r\n        ws.binaryType = \"arraybuffer\"\r\n        ws.onopen = function (event) {\r\n            this.connectNum=0;\r\n            console.log(\"------ws onopen net.loginOk is \" + net.loginOk)\r\n            // cc.director.getScene().getChildByName('Canvas').getChildByName('LoginLayer').getChildByName(\"test\").getChildByName(\"lianjie\").active=false;\r\n            //网络连接成功\r\n            // EventManager.Dispatch('netSuccess'); //  EASON COMMENT\r\n            net.conneting = false;\r\n            net.isActive = true\r\n            //连接成功，则进行登录处理.\r\n            if(net.loginOk)\r\n            {\r\n                //已经登录过后的重连，通过token登录\r\n                // setTimeout(function() {\r\n                //     net.CertificaitonLoginReq();\r\n                // }, 0.01); \r\n                // CacheSendMsgs.length = 0\r\n            }\r\n            // else\r\n            // {\r\n            //     console.log(\"------ws onopen first login. \")  \r\n            // }\r\n        }\r\n\r\n        ws.onmessage = function (event) {\r\n            \r\n            net.lastMsgTime = new Date();//网络检测\r\n            net.waitGatewayHeartbeatNum = 0;//网络检测\r\n\r\n            setTimeout(function() {\r\n                // UIManager.WaitEnd()\r\n                var rsp;\r\n                var len = event.data.byteLength;\r\n                try\r\n                {\r\n                    console.log(\"msg data size \" + event.data.byteLength)\r\n                    rsp = net.OnRecvMsg(event.data); \r\n                    if(rsp == null)\r\n                    {\r\n                        //console.error(\" recv msg function parse msg error \");\r\n                        net.printNetDataInfo(event.data, null);\r\n                        return;\r\n                    }\r\n                }\r\n                catch(err)\r\n                {\r\n                    console.log(\"CATCH err\")\r\n                    //console.error(\" recv msg catch error \" + event.data);\r\n                    net.printNetDataInfo(event.data, err);\r\n                    return;\r\n                } \r\n                try {\r\n                    console.log(\"--->Recv cmd:\"+net.MsgCmd[rsp.cmd] + \",Msg：\"+JSON.stringify(rsp))    \r\n                    var callback = onMsgList[rsp.cmd]\r\n                    if(!callback){\r\n                        callback = net[\"On\"+net.MsgCmd[rsp.cmd]]\r\n                    }\r\n                    if(callback){ \r\n                        callback(rsp.msg)\r\n                    }\r\n                }\r\n                catch (error) { \r\n                    console.error(\"------ onmessage callback find  logic error:  \" + rsp.cmd + \", \" + error.stack);\r\n                    console.error(\"--->Recv cmd:\" + net.MsgCmd[rsp.cmd] + \"，Msg：\" + JSON.stringify(rsp));\r\n                }\r\n            },100);\r\n        }\r\n\r\n        ws.onerror = function (event) {\r\n            console.log(\"---ws onerror---. \")\r\n            net.conneting = false;\r\n            ws.close();\r\n            console.log(\"lianjieshibai\")  \r\n        }\r\n\r\n        ws.onclose = function (event) {\r\n            console.log(\"---ws onclose---. \")\r\n            net.conneting = false;\r\n            ws = null\r\n            net.isActive = false  \r\n            if(net.loginOk){\r\n                net.loginOk=false;\r\n                cc.director.getScene().getChildByName('Canvas').getChildByName('WindowLayer').getComponent('WindowLayer').openTips('1003');\r\n                cc.director.getScene().getChildByName('Canvas').getChildByName('MainLayer').getComponent('Player').resetGame(2);  \r\n            }else{\r\n                if(net.indexPort<net.ServerPort.length){ \r\n                   net.Connect(); \r\n                   net.indexPort++;\r\n                }else{\r\n                   net.indexPort=0;\r\n                }  \r\n            } \r\n      }\r\n    }.bind(this),0);\r\n}\r\n\r\nnet.getWSState = function()\r\n{\r\n    if(ws == null)\r\n        return WebSocket.CLOSED;\r\n    return ws.readyState;\r\n}\r\n\r\nnet.close = function()\r\n{\r\n    console.log(\"net.Close------>\")\r\n    if (ws)\r\n        ws.close();\r\n}\r\n\r\nconst UserStatus =\r\n{\r\n\tOffline:0,\r\n\tOut:1 ,\r\n\tLogout:2,\r\n\tDelegated:3,\r\n\tInArena:4,\r\n\tInRoom:5,\r\n\tWaitReenter:6,\r\n\tSit:7,\r\n\tReady:8,\r\n\tPlaying:9,\r\n\tOnPhone:10,\r\n}\r\n\r\nnet.UserStatus = UserStatus;\r\n\r\nmodule.exports = net"]}