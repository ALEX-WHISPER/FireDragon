{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\FireDragon\\GamePlay\\Game/assets\\scripts\\FireDragon\\GamePlay\\Game\\GameView.js"],"names":["Flags","require","catchingMsgItemPool","cc","Class","extends","Component","properties","scrollView","default","type","ScrollView","scrollItemTotalCount","scrollItemMaxCount","catchingMinusInfo","Node","msgItemPoolController","itemTemplate","Prefab","lable_CurTreasureCount","Label","lable_MagnificationCount","playButton","Button","startPlayLabelStr","continueLabelStr","pauseLabelStr","onLoad","content","items","labelChanged_PlayButton","start","active","opacity","setNewTreasure","newTreasure","string","setNewMag","newMag","setCatchingMinusInfo","curMagValue","runAction","fadeOut","getChildByName","getComponent","toString","onHitPlayButton","onHitPauseButton","spriteChanged_PlayButton","spritesArray","normalSprite","pressedSprite","hoverSprite","disabledSprite","tarStats","node","onScrollViewVicItemAdded","msg","maxCount","first","shift","removeChild","itemPool","put","item","size","get","console","log","addChild","push","height","Sprite","spriteFrame","enemyImg","attackObj","result","length","onRunningOutofTreasure","playButtonSprites","interactable","onResumeEnoughTreasure"],"mappings":"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","file":"GameView.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\FireDragon\\GamePlay\\Game","sourcesContent":["var Flags = require(\"GameFlags\");\r\nvar catchingMsgItemPool = require(\"CatchingMsgItemPool\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        scrollView: {\r\n        \tdefault: null,\r\n        \ttype: cc.ScrollView\r\n        },\r\n\r\n        scrollItemTotalCount: 0,\r\n        scrollItemMaxCount: 30,\r\n\r\n        catchingMinusInfo: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        msgItemPoolController: {\r\n            default: null,\r\n            type: catchingMsgItemPool\r\n        },\r\n\r\n        itemTemplate: { // item template to instantiate other items\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n\r\n        lable_CurTreasureCount: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        lable_MagnificationCount: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        playButton: {\r\n            default: null,\r\n            type: cc.Button\r\n        },\r\n        \r\n        startPlayLabelStr: '',\r\n        continueLabelStr: '',\r\n        pauseLabelStr: '',\r\n    },\r\n\r\n    onLoad: function() {\r\n        this.content = this.scrollView.content;\r\n        this.items = []; // array to store spawned items\r\n        this.labelChanged_PlayButton(-1);        \r\n    },\r\n\r\n    start: function() {\r\n        if (!this.catchingMinusInfo.active) {\r\n            this.catchingMinusInfo.active = true;\r\n            this.catchingMinusInfo.opacity = 0;\r\n        }\r\n    },\r\n\r\n    //  update current treasure count\r\n    setNewTreasure: function(newTreasure) {\r\n        this.lable_CurTreasureCount.string = newTreasure;\r\n    },\r\n\r\n    //  update current magnification count\r\n    setNewMag: function(newMag) {\r\n        if(newMag != this.lable_MagnificationCount.string) {\r\n            this.lable_MagnificationCount.string = newMag;\r\n        }\r\n    },\r\n\r\n    //  pop out catching-minus floating box\r\n    setCatchingMinusInfo: function(curMagValue) {\r\n        this.catchingMinusInfo.opacity = 255;\r\n        this.catchingMinusInfo.runAction(cc.fadeOut(1));\r\n        this.catchingMinusInfo.getChildByName(\"minusCount\").getComponent(cc.Label).string = \"-\" + curMagValue.toString();\r\n    },\r\n\r\n    //  update the button sprite frames: play -> pause\r\n    onHitPlayButton: function() {\r\n        // this.spriteChanged_PlayButton(this.playButtonSprites);        \r\n        this.labelChanged_PlayButton(0);\r\n    },\r\n\r\n    //  update the button sprite frames: pause -> play \r\n    onHitPauseButton: function() {\r\n        // this.spriteChanged_PlayButton(this.playButtonSprites);\r\n        this.labelChanged_PlayButton(1);        \r\n    },\r\n\r\n    spriteChanged_PlayButton: function(spritesArray) {\r\n        this.playButton.normalSprite = spritesArray[0];\r\n        this.playButton.pressedSprite = spritesArray[1];\r\n        this.playButton.hoverSprite = spritesArray[2];\r\n        this.playButton.disabledSprite = spritesArray[3];\r\n    },\r\n\r\n    labelChanged_PlayButton: function(tarStats) {\r\n        //  on start\r\n        if (tarStats === -1) {\r\n            this.playButton.node.getChildByName('Label').getComponent(cc.Label).string = this.startPlayLabelStr;            \r\n        }\r\n\r\n        //  on pause\r\n        if (tarStats === 0) {\r\n            this.playButton.node.getChildByName('Label').getComponent(cc.Label).string = this.pauseLabelStr;\r\n        }\r\n\r\n        //  on continue\r\n        if (tarStats === 1) {\r\n            this.playButton.node.getChildByName('Label').getComponent(cc.Label).string = this.continueLabelStr;            \r\n        }\r\n    },\r\n\r\n    //  add catching result item to scrollView\r\n    onScrollViewVicItemAdded: function(msg) {\r\n        if (this.scrollItemTotalCount >= this.msgItemPoolController.maxCount) {\r\n            var first = this.items.shift();\r\n            this.scrollItemTotalCount--;\r\n            this.content.removeChild(first);\r\n            \r\n            this.msgItemPoolController.itemPool.put(first); //  put the item been removed to object pool for reusing\r\n        }\r\n\r\n        let item = null;\r\n        if (this.msgItemPoolController.itemPool.size() > 0) {\r\n            item = this.msgItemPoolController.itemPool.get();\r\n            console.log(\"get available item from itemPool\");\r\n        } else {\r\n            console.log(\"no available item in itemPool!!!\");\r\n            return;\r\n        }\r\n        this.content.addChild(item);\r\n        this.items.push(item);\r\n\r\n        this.content.height = (this.scrollItemTotalCount + 1) * item.height + item.height;\r\n        this.scrollItemTotalCount++;\r\n\r\n        item.getChildByName(\"enemyImg\").getComponent(cc.Sprite).spriteFrame = msg.enemyImg;\r\n        item.getChildByName(\"attackObj\").getComponent(cc.Label).string = msg.attackObj;\r\n        item.getChildByName(\"result\").getComponent(cc.Label).string = msg.result;\r\n        \r\n        console.log(\"attackObj: \" + msg.attackObj + \", result: \" + msg.result + \", itemCount: \" + this.items.length);\r\n    },\r\n\r\n    //  when treasure is running out\r\n    onRunningOutofTreasure: function() {\r\n        this.spriteChanged_PlayButton(this.playButtonSprites);\r\n        this.playButton.interactable = false;\r\n    },\r\n\r\n    onResumeEnoughTreasure: function() {\r\n        this.playButton.interactable = true;\r\n    }\r\n});\r\n"]}