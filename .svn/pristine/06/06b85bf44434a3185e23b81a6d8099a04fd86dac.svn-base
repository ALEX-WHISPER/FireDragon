{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\Game.js"],"names":["cc","Class","extends","Component","properties","reloadOnGameOver","readyToPlay","startPrefab","default","type","Prefab","starLife_MaxDuration","starLife_MinDuration","ground","Node","player","scoreAudio","url","AudioClip","onEnable","eventsRegistration","onLoad","varsInitOnLoad","update","dt","elapsedTime","starLifeTime","gameOver","progressValue","NOTIFICATION","emit","STAR_DISAPPEARING","msg","toString","onDisable","eventsDeRegistration","on","GAME_START","onGameStart","GAME_OVER","onGameOver","GAME_PAUSED","onGamePaused","GAME_RESUME","onGameResume","GAME_RESTART","onGameRestart","off","groundY","y","height","score","starSpawner","getComponent","director","loadScene","newStar","instantiate","starPos","getNewStarPosition","node","getChildByName","addChild","game","setPosition","PROGRESSBAR_FOLLOWSTAR","pos","random0To1","randX","randY","randomMinus1To1","width","jumpHeight","p","gainScore","SCORE_CHANGED","audioEngine","playEffect"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        reloadOnGameOver: false,\r\n        readyToPlay: false,\r\n\r\n        //  star prefab\r\n        startPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n\r\n        //  disappear duration of stars\r\n        starLife_MaxDuration: 0,\r\n        starLife_MinDuration: 0,\r\n\r\n        //  ground node, to get the ground height\r\n        ground: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        //  player node, to get the player's jump height\r\n        player: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        scoreAudio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n    },\r\n\r\n//#region Life cycle\r\n    onEnable: function() {\r\n        this.eventsRegistration();\r\n    },\r\n\r\n    onLoad: function() {\r\n        this.varsInitOnLoad();\r\n    },\r\n\r\n    update: function(dt) {\r\n        if (!this.readyToPlay) {\r\n            return;\r\n        }\r\n        if (this.elapsedTime > this.starLifeTime) {\r\n            this.gameOver();\r\n            return;\r\n        }\r\n        this.elapsedTime += dt;\r\n        \r\n        var progressValue = 1 - this.elapsedTime / this.starLifeTime;\r\n        NOTIFICATION.emit(STAR_DISAPPEARING, {msg: progressValue.toString()});\r\n    },\r\n\r\n    onDisable: function() {\r\n        this.eventsDeRegistration();\r\n    },\r\n//#endregion\r\n\r\n//#region Game logic\r\n    eventsRegistration: function() {\r\n        NOTIFICATION.on(GAME_START, this.onGameStart, this);\r\n        NOTIFICATION.on(GAME_OVER, this.onGameOver, this);\r\n        NOTIFICATION.on(GAME_PAUSED, this.onGamePaused, this);\r\n        NOTIFICATION.on(GAME_RESUME, this.onGameResume, this);\r\n        NOTIFICATION.on(GAME_RESTART, this.onGameRestart, this);        \r\n    },\r\n\r\n    eventsDeRegistration: function() {\r\n        NOTIFICATION.off(GAME_START, this.onGameStart, this);\r\n        NOTIFICATION.off(GAME_OVER, this.onGameOver, this);\r\n        NOTIFICATION.off(GAME_PAUSED, this.onGamePaused, this);\r\n        NOTIFICATION.off(GAME_RESUME, this.onGameResume, this);\r\n        NOTIFICATION.off(GAME_RESTART, this.onGameRestart, this);        \r\n    },\r\n\r\n    varsInitOnLoad: function() {\r\n        this.groundY = this.ground.y + this.ground.height/2;\r\n\r\n        //  initial variables\r\n        this.elapsedTime = 0;\r\n        this.starLifeTime = 0;\r\n        this.score = 0;\r\n    },\r\n\r\n    onGameStart: function() {\r\n        this.starSpawner();\r\n        this.readyToPlay = true;\r\n        this.player.getComponent('Player').onGameStart();\r\n    },\r\n\r\n    onGameOver: function() {\r\n        this.readyToPlay = false;\r\n        this.player.getComponent('Player').onGameOver();\r\n    },\r\n\r\n    onGamePaused: function() {\r\n        this.readyToPlay = false;\r\n        this.player.getComponent('Player').onGamePaused();\r\n    },\r\n\r\n    onGameResume: function() {\r\n        this.readyToPlay = true;\r\n        this.player.getComponent('Player').onGameResume();\r\n    },\r\n\r\n    onGameRestart: function() {\r\n        cc.director.loadScene('main');\r\n    },\r\n\r\n    starSpawner: function() {\r\n        var newStar = cc.instantiate(this.startPrefab);\r\n        var starPos = this.getNewStarPosition();\r\n\r\n        this.node.getChildByName(\"GamePlay\").addChild(newStar);\r\n\r\n        //  set reference of property: 'game' in 'Star.js', to make bridge for stars to get player's motion\r\n        newStar.getComponent('Star').game = this;\r\n        newStar.setPosition(starPos);\r\n        NOTIFICATION.emit(PROGRESSBAR_FOLLOWSTAR, {pos: starPos});\r\n\r\n        this.starLifeTime = this.starLife_MinDuration + cc.random0To1() * (this.starLife_MaxDuration - this.starLife_MinDuration);\r\n        this.elapsedTime = 0;\r\n    },\r\n\r\n    getNewStarPosition: function() {\r\n        var randX = 0;\r\n        var randY = 0;\r\n        \r\n        randX = cc.randomMinus1To1() * this.node.width/2;\r\n        randY = this.groundY + cc.random0To1() * this.player.getComponent('Player').jumpHeight + 50;\r\n        return cc.p(randX, randY);\r\n    },\r\n\r\n    gainScore: function() {\r\n        this.score += 1;\r\n        // this.scoreLable.string = this.scoreHintText + this.score.toString();\r\n        NOTIFICATION.emit(SCORE_CHANGED, {msg: this.score.toString()});\r\n        cc.audioEngine.playEffect(this.scoreAudio, false);\r\n    },\r\n\r\n    gameOver: function() {\r\n        NOTIFICATION.emit(GAME_OVER, {msg: 'gameOver, trigger to call GAME_OVER event', score: this.score.toString()});\r\n    },\r\n//#endregion\r\n});"]}